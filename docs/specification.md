# Bristool 仕様書

## 概要

Bristoolは、ブリストルスケールを使用して排便記録を管理するWebアプリケーションです。ユーザーは日々の排便状態を記録し、健康管理に役立てることができます。

## 機能仕様

### 1. ユーザー認証

#### 1.1 サインアップ
- メールアドレスとパスワードで新規登録
- 確認メールが送信され、メール内のリンクをクリックして認証完了
- 認証完了後、自動的にサインイン状態になる

#### 1.2 サインイン
- メールアドレスとパスワードでログイン
- ログイン成功後、`/protected`ページへリダイレクト

#### 1.3 パスワードリセット
- メールアドレスを入力してパスワードリセットメールを送信
- メール内のリンクから新しいパスワードを設定

#### 1.4 サインアウト
- ヘッダーのサインアウトボタンからログアウト
- ログアウト後、`/sign-in`ページへリダイレクト

### 2. 排便記録機能

#### 2.1 新規記録の作成
**入力項目：**
- **日付**: カレンダーから選択（デフォルト：当日）
- **時刻**: 時刻選択（デフォルト：現在時刻）
- **ブリストルスケール**: 1〜7の7段階評価
  - 1: 硬くてコロコロの兎糞状の（排便困難）
  - 2: ソーセージ状だが硬い
  - 3: 表面にひび割れのあるソーセージ状
  - 4: 滑らかで軟らかいソーセージ状、へび状
  - 5: はっきりとした境界のある柔らかい小片
  - 6: 境界がほぐれて、ふにゃふにゃの不定形
  - 7: 水様、固形物を含まない液状
- **量**: 0〜100のスライダーで選択
- **色**: 1〜7の7段階評価

#### 2.2 記録の一覧表示
- `/protected`ページで自分の記録一覧を表示
- 各記録には以下の情報を表示：
  - 日時
  - ブリストルスケール値と説明
  - 量（プログレスバーで視覚化）
  - 色
- 記録は日時の降順で表示

#### 2.3 記録の編集
- 各記録の「編集」ボタンをクリックして編集モード
- ポップオーバー内で情報を編集
- 保存ボタンで更新を確定

#### 2.4 記録の削除
- 各記録の「削除」ボタンをクリック
- 確認なしで即座に削除（要改善）

### 3. ナビゲーション

#### 3.1 ヘッダーナビゲーション
- ロゴ（ホームへのリンク）
- 認証状態に応じた表示：
  - 未認証時：「Sign in」リンク
  - 認証時：ユーザーメール表示、「Sign out」ボタン

#### 3.2 主要ページ
- `/` - ランディングページ
- `/sign-in` - サインインページ
- `/sign-up` - サインアップページ
- `/forgot-password` - パスワードリセットページ
- `/protected` - 記録一覧ページ（認証必須）
- `/new-stool` - 新規記録作成ページ
- `/protected/reset-password` - パスワード再設定ページ

## 技術仕様

### データベース構造

#### stool_records テーブル
| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | UUID | 主キー |
| created_at | TIMESTAMP | レコード作成日時 |
| user_id | UUID | ユーザーID（auth.usersを参照） |
| date | TIMESTAMP | 記録日時 |
| scale | INTEGER | ブリストルスケール値（1-7） |
| volume | INTEGER | 量（0-100） |
| color | INTEGER | 色評価（1-7） |

### セキュリティ
- Supabase Row Level Security (RLS) を使用
- ユーザーは自分の記録のみ閲覧・編集・削除可能
- 認証が必要なページはサーバーサイドで認証チェック

### UI/UX設計
- レスポンシブデザイン対応
- ダークモード対応（next-themes使用）
- shadcn/uiコンポーネントライブラリ使用
- 日本語UI

## 今後の改善点

1. **削除確認ダイアログ**: 記録削除時に確認ダイアログを表示
2. **データ可視化**: 記録データのグラフ表示機能
3. **エクスポート機能**: CSVやPDFでのデータエクスポート
4. **通知機能**: 定期的な記録を促す通知
5. **メモ機能**: 各記録に自由記述のメモを追加
6. **画像アップロード**: ブリストルスケールの実際の画像を使用
7. **多言語対応**: 英語など他言語への対応